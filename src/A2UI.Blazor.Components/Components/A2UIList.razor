@inherits A2UIComponentBase

<div class="@GetCssClass()" style="@GetCombinedStyle()">
    @if (ChildrenIds != null)
    {
        @foreach (var childId in ChildrenIds)
        {
            <A2UIRenderer SurfaceId="@SurfaceId" ComponentId="@childId" />
        }
    }
</div>

@code {
    private List<string>? ChildrenIds;
    private string? Direction;
    private string? Alignment;

    protected override void OnParametersSet()
    {
        base.OnParametersSet();

        var childrenData = GetDictionaryProperty("children");
        if (childrenData != null && childrenData.TryGetValue("explicitList", out var explicitList))
        {
            if (explicitList is List<string> stringList)
            {
                ChildrenIds = stringList.ToList();
            }
            else if (explicitList is List<object> objectList)
            {
                ChildrenIds = objectList.Select(x => x?.ToString()).Where(x => !string.IsNullOrEmpty(x)).ToList()!;
            }
            else if (explicitList is string[] stringArray)
            {
                ChildrenIds = stringArray.ToList();
            }
            else if (explicitList is object[] objectArray)
            {
                ChildrenIds = objectArray.Select(x => x?.ToString()).Where(x => !string.IsNullOrEmpty(x)).ToList()!;
            }
            else if (explicitList is System.Text.Json.JsonElement jsonElement)
            {
                try
                {
                    ChildrenIds = System.Text.Json.JsonSerializer.Deserialize<List<string>>(jsonElement.GetRawText()) ?? new List<string>();
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"[A2UIList] Failed to deserialize explicitList: {ex.Message}");
                    ChildrenIds = new List<string>();
                }
            }
        }

        Direction = GetStringProperty("direction");
        Alignment = GetStringProperty("alignment");
    }

    protected override string GetCssClass()
    {
        return Theme.Components.List;
    }

    private string GetCombinedStyle()
    {
        var styles = new List<string> { GetInlineStyle() };

        if (Direction?.ToLower() == "horizontal")
        {
            styles.Add("flex-direction: row");
        }
        else
        {
            styles.Add("flex-direction: column");
        }

        if (!string.IsNullOrEmpty(Alignment))
        {
            var alignItems = Alignment.ToLower() switch
            {
                "start" => "flex-start",
                "end" => "flex-end",
                "center" => "center",
                "stretch" => "stretch",
                _ => "stretch"
            };
            styles.Add($"align-items: {alignItems}");
        }

        return string.Join("; ", styles.Where(s => !string.IsNullOrEmpty(s)));
    }
}

